const { open  } = Deno;
import { BufReader } from "./vendor/https/deno.land/std/io/bufio.ts";
import { Buffer } from "./vendor/https/deno.land/std/io/buffer.ts";
import { readAll } from "./vendor/https/deno.land/std/io/util.ts";
import escape from "./vendor/https/deno.land/x/lodash/escape.js";
var ReadMode;
(function(ReadMode) {
    ReadMode[ReadMode["Normal"] = 0] = "Normal";
    ReadMode[ReadMode["Escaped"] = 1] = "Escaped";
    ReadMode[ReadMode["Raw"] = 2] = "Raw";
    ReadMode[ReadMode["Comment"] = 3] = "Comment";
    ReadMode[ReadMode["Evaluate"] = 4] = "Evaluate";
})(ReadMode || (ReadMode = {
}));
var Codes;
(function(Codes) {
    Codes[Codes["Begin"] = 60] = "Begin";
    Codes[Codes["End"] = 62] = "End";
    Codes[Codes["Percent"] = 37] = "Percent";
    Codes[Codes["Escaped"] = 61] = "Escaped";
    Codes[Codes["Raw"] = 45] = "Raw";
    Codes[Codes["Comment"] = 35] = "Comment";
})(Codes || (Codes = {
}));
const encoder = new TextEncoder();
const decoder = new TextDecoder("utf-8");
class StringReader extends Buffer {
    constructor(s){
        super(encoder.encode(s).buffer);
    }
}
async function include(path, params) {
    const result = await renderFile(path, params);
    const buf = new Buffer();
    await buf.readFrom(result);
    return await bufToStr(buf);
}
function sanitize(str) {
    return str.replace(/\`/g, "\\`").replace(/\$/g, "\\$").replace(/\\+$/, ""); // Trim backslashes at line end. TODO: Fix this to render backslashes.
}
async function bufToStr(buf) {
    return decoder.decode(await readAll(buf));
}
function removeLastSemi(s) {
    return s.trimRight().replace(/;$/, "");
}
async function bufToStrWithSanitize(buf) {
    return sanitize(await bufToStr(buf));
}
function NewTemplate(script) {
    return async (params)=>{
        const output = [];
        await new Promise((resolve, reject)=>{
            const args = {
                include,
                ...params,
                $$OUTPUT: output,
                $$FINISHED: resolve,
                $$ERROR: reject,
                $$ESCAPE: escape
            };
            const src = `(async() => {
        try { ${script} } catch (error) { $$ERROR(error) }
        $$FINISHED();
      })();`;
            const f = new Function(...Object.keys(args), src);
            f(...Object.values(args));
        });
        return output.join("");
    };
}
export async function compile(reader) {
    const src = new BufReader(reader);
    const buf = [];
    const statements = [];
    const statementBuf = new Buffer();
    let readMode = ReadMode.Normal;
    const statementBufWrite = async (byte)=>await statementBuf.write(new Uint8Array([
            byte
        ]))
    ;
    while(true){
        const byte = await src.readByte();
        if (byte === null) {
            break;
        }
        buf.push(byte);
        if (buf.length < 3) {
            continue;
        }
        if (readMode === ReadMode.Normal) {
            // Detect ReadMode
            if (buf[0] === Codes.Begin && buf[1] === Codes.Percent) {
                switch(buf[2]){
                    case Codes.Escaped:
                        readMode = ReadMode.Escaped;
                        break;
                    case Codes.Raw:
                        readMode = ReadMode.Raw;
                        break;
                    case Codes.Comment:
                        readMode = ReadMode.Comment;
                        break;
                    default:
                        readMode = ReadMode.Evaluate;
                        break;
                }
                statements.push(`;$$OUTPUT.push(\`${await bufToStrWithSanitize(statementBuf)}\`);`);
                statementBuf.reset();
                buf.splice(0);
                continue;
            }
            if (buf.length > 2) {
                await statementBufWrite(buf.shift());
            }
            continue;
        }
        // Finish current ReadMode
        if (buf[1] === Codes.Percent && buf[2] === Codes.End) {
            statementBufWrite(buf.shift());
            buf.splice(0);
            // Don't execute if ReadMode is Comment.
            if (readMode !== ReadMode.Comment) {
                switch(readMode){
                    case ReadMode.Raw:
                        statements.push(`;$$OUTPUT.push(${removeLastSemi(await bufToStr(statementBuf))});`);
                        break;
                    case ReadMode.Escaped:
                        statements.push(`;$$OUTPUT.push($$ESCAPE(${removeLastSemi(await bufToStr(statementBuf))}));`);
                        break;
                    case ReadMode.Evaluate:
                        statements.push(await bufToStr(statementBuf));
                        break;
                }
            }
            statementBuf.reset();
            readMode = ReadMode.Normal;
            continue;
        }
        await statementBufWrite(buf.shift());
    }
    // Flush buffer
    while(buf.length > 0){
        await statementBufWrite(buf.shift());
    }
    statements.push(`$$OUTPUT.push(\`${await bufToStrWithSanitize(statementBuf)}\`);`);
    statementBuf.reset();
    return await NewTemplate(statements.join(""));
}
export async function renderToString(body, params) {
    const reader = new StringReader(body);
    const template = await compile(reader);
    return template(params);
}
export async function renderFileToString(path, params) {
    const file = await open(path);
    const template = await compile(file);
    file.close();
    return template(params);
}
export async function render(body, params) {
    const result = await renderToString(body, params);
    return new StringReader(result);
}
export async function renderFile(path, params) {
    const result = await renderFileToString(path, params);
    return new StringReader(result);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImh0dHBzOi8vZGVuby5sYW5kL3gvZGVqc0AwLjEwLjMvbW9kLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHsgb3BlbiB9ID0gRGVubztcbnR5cGUgUmVhZGVyID0gRGVuby5SZWFkZXI7XG5pbXBvcnQgeyBCdWZSZWFkZXIgfSBmcm9tIFwiLi92ZW5kb3IvaHR0cHMvZGVuby5sYW5kL3N0ZC9pby9idWZpby50c1wiO1xuaW1wb3J0IHsgQnVmZmVyIH0gZnJvbSBcIi4vdmVuZG9yL2h0dHBzL2Rlbm8ubGFuZC9zdGQvaW8vYnVmZmVyLnRzXCI7XG5pbXBvcnQgeyByZWFkQWxsIH0gZnJvbSBcIi4vdmVuZG9yL2h0dHBzL2Rlbm8ubGFuZC9zdGQvaW8vdXRpbC50c1wiO1xuaW1wb3J0IGVzY2FwZSBmcm9tIFwiLi92ZW5kb3IvaHR0cHMvZGVuby5sYW5kL3gvbG9kYXNoL2VzY2FwZS5qc1wiO1xuXG5leHBvcnQgaW50ZXJmYWNlIFBhcmFtcyB7XG4gIC8vZGVuby1saW50LWlnbm9yZSBuby1leHBsaWNpdC1hbnlcbiAgW2tleTogc3RyaW5nXTogYW55O1xufVxuXG5lbnVtIFJlYWRNb2RlIHtcbiAgTm9ybWFsLFxuICBFc2NhcGVkLFxuICBSYXcsXG4gIENvbW1lbnQsXG4gIEV2YWx1YXRlLFxufVxuXG5lbnVtIENvZGVzIHtcbiAgQmVnaW4gPSA2MCwgLy8gPFxuICBFbmQgPSA2MiwgLy8gPlxuICBQZXJjZW50ID0gMzcsIC8vICVcbiAgRXNjYXBlZCA9IDYxLCAvLyA9XG4gIFJhdyA9IDQ1LCAvLyAtXG4gIENvbW1lbnQgPSAzNSwgLy8gI1xufVxuXG5pbnRlcmZhY2UgVGVtcGxhdGUge1xuICAocGFyYW1zOiBQYXJhbXMpOiBQcm9taXNlPHN0cmluZz47XG59XG5cbmNvbnN0IGVuY29kZXIgPSBuZXcgVGV4dEVuY29kZXIoKTtcbmNvbnN0IGRlY29kZXIgPSBuZXcgVGV4dERlY29kZXIoXCJ1dGYtOFwiKTtcblxuY2xhc3MgU3RyaW5nUmVhZGVyIGV4dGVuZHMgQnVmZmVyIHtcbiAgY29uc3RydWN0b3Ioczogc3RyaW5nKSB7XG4gICAgc3VwZXIoZW5jb2Rlci5lbmNvZGUocykuYnVmZmVyKTtcbiAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiBpbmNsdWRlKHBhdGg6IHN0cmluZywgcGFyYW1zOiBQYXJhbXMpOiBQcm9taXNlPHN0cmluZz4ge1xuICBjb25zdCByZXN1bHQgPSBhd2FpdCByZW5kZXJGaWxlKHBhdGgsIHBhcmFtcyk7XG4gIGNvbnN0IGJ1ZiA9IG5ldyBCdWZmZXIoKTtcbiAgYXdhaXQgYnVmLnJlYWRGcm9tKHJlc3VsdCk7XG4gIHJldHVybiBhd2FpdCBidWZUb1N0cihidWYpO1xufVxuXG5mdW5jdGlvbiBzYW5pdGl6ZShzdHI6IHN0cmluZyk6IHN0cmluZyB7XG4gIHJldHVybiBzdHIucmVwbGFjZSgvXFxgL2csIFwiXFxcXGBcIikucmVwbGFjZSgvXFwkL2csIFwiXFxcXCRcIikucmVwbGFjZSgvXFxcXCskLywgXCJcIik7IC8vIFRyaW0gYmFja3NsYXNoZXMgYXQgbGluZSBlbmQuIFRPRE86IEZpeCB0aGlzIHRvIHJlbmRlciBiYWNrc2xhc2hlcy5cbn1cblxuYXN5bmMgZnVuY3Rpb24gYnVmVG9TdHIoYnVmOiBCdWZmZXIpOiBQcm9taXNlPHN0cmluZz4ge1xuICByZXR1cm4gZGVjb2Rlci5kZWNvZGUoYXdhaXQgcmVhZEFsbChidWYpKTtcbn1cblxuZnVuY3Rpb24gcmVtb3ZlTGFzdFNlbWkoczogc3RyaW5nKTogc3RyaW5nIHtcbiAgcmV0dXJuIHMudHJpbVJpZ2h0KCkucmVwbGFjZSgvOyQvLCBcIlwiKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gYnVmVG9TdHJXaXRoU2FuaXRpemUoYnVmOiBCdWZmZXIpOiBQcm9taXNlPHN0cmluZz4ge1xuICByZXR1cm4gc2FuaXRpemUoYXdhaXQgYnVmVG9TdHIoYnVmKSk7XG59XG5cbmZ1bmN0aW9uIE5ld1RlbXBsYXRlKHNjcmlwdDogc3RyaW5nKTogVGVtcGxhdGUge1xuICByZXR1cm4gYXN5bmMgKHBhcmFtczogUGFyYW1zKTogUHJvbWlzZTxzdHJpbmc+ID0+IHtcbiAgICBjb25zdCBvdXRwdXQ6IEFycmF5PHN0cmluZz4gPSBbXTtcbiAgICBhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBjb25zdCBhcmdzID0ge1xuICAgICAgICBpbmNsdWRlLFxuICAgICAgICAuLi5wYXJhbXMsXG4gICAgICAgICQkT1VUUFVUOiBvdXRwdXQsXG4gICAgICAgICQkRklOSVNIRUQ6IHJlc29sdmUsXG4gICAgICAgICQkRVJST1I6IHJlamVjdCxcbiAgICAgICAgJCRFU0NBUEU6IGVzY2FwZSxcbiAgICAgIH07XG4gICAgICBjb25zdCBzcmMgPSBgKGFzeW5jKCkgPT4ge1xuICAgICAgICB0cnkgeyAke3NjcmlwdH0gfSBjYXRjaCAoZXJyb3IpIHsgJCRFUlJPUihlcnJvcikgfVxuICAgICAgICAkJEZJTklTSEVEKCk7XG4gICAgICB9KSgpO2A7XG4gICAgICBjb25zdCBmID0gbmV3IEZ1bmN0aW9uKC4uLk9iamVjdC5rZXlzKGFyZ3MpLCBzcmMpO1xuICAgICAgZiguLi5PYmplY3QudmFsdWVzKGFyZ3MpKTtcbiAgICB9KTtcbiAgICByZXR1cm4gb3V0cHV0LmpvaW4oXCJcIik7XG4gIH07XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjb21waWxlKHJlYWRlcjogUmVhZGVyKTogUHJvbWlzZTxUZW1wbGF0ZT4ge1xuICBjb25zdCBzcmMgPSBuZXcgQnVmUmVhZGVyKHJlYWRlcik7XG4gIGNvbnN0IGJ1ZjogQXJyYXk8bnVtYmVyPiA9IFtdO1xuICBjb25zdCBzdGF0ZW1lbnRzOiBBcnJheTxzdHJpbmc+ID0gW107XG4gIGNvbnN0IHN0YXRlbWVudEJ1ZiA9IG5ldyBCdWZmZXIoKTtcbiAgbGV0IHJlYWRNb2RlOiBSZWFkTW9kZSA9IFJlYWRNb2RlLk5vcm1hbDtcbiAgY29uc3Qgc3RhdGVtZW50QnVmV3JpdGUgPSBhc3luYyAoYnl0ZTogbnVtYmVyKTogUHJvbWlzZTxudW1iZXI+ID0+XG4gICAgYXdhaXQgc3RhdGVtZW50QnVmLndyaXRlKG5ldyBVaW50OEFycmF5KFtieXRlXSkpO1xuXG4gIHdoaWxlICh0cnVlKSB7XG4gICAgY29uc3QgYnl0ZSA9IGF3YWl0IHNyYy5yZWFkQnl0ZSgpO1xuICAgIGlmIChieXRlID09PSBudWxsKSB7XG4gICAgICBicmVhaztcbiAgICB9XG5cbiAgICBidWYucHVzaChieXRlKTtcbiAgICBpZiAoYnVmLmxlbmd0aCA8IDMpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIGlmIChyZWFkTW9kZSA9PT0gUmVhZE1vZGUuTm9ybWFsKSB7XG4gICAgICAvLyBEZXRlY3QgUmVhZE1vZGVcbiAgICAgIGlmIChidWZbMF0gPT09IENvZGVzLkJlZ2luICYmIGJ1ZlsxXSA9PT0gQ29kZXMuUGVyY2VudCkge1xuICAgICAgICBzd2l0Y2ggKGJ1ZlsyXSkge1xuICAgICAgICAgIGNhc2UgQ29kZXMuRXNjYXBlZDpcbiAgICAgICAgICAgIHJlYWRNb2RlID0gUmVhZE1vZGUuRXNjYXBlZDtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgQ29kZXMuUmF3OlxuICAgICAgICAgICAgcmVhZE1vZGUgPSBSZWFkTW9kZS5SYXc7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIENvZGVzLkNvbW1lbnQ6XG4gICAgICAgICAgICByZWFkTW9kZSA9IFJlYWRNb2RlLkNvbW1lbnQ7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgcmVhZE1vZGUgPSBSZWFkTW9kZS5FdmFsdWF0ZTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHN0YXRlbWVudHMucHVzaChcbiAgICAgICAgICBgOyQkT1VUUFVULnB1c2goXFxgJHthd2FpdCBidWZUb1N0cldpdGhTYW5pdGl6ZShzdGF0ZW1lbnRCdWYpfVxcYCk7YCxcbiAgICAgICAgKTtcbiAgICAgICAgc3RhdGVtZW50QnVmLnJlc2V0KCk7XG4gICAgICAgIGJ1Zi5zcGxpY2UoMCk7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgaWYgKGJ1Zi5sZW5ndGggPiAyKSB7XG4gICAgICAgIGF3YWl0IHN0YXRlbWVudEJ1ZldyaXRlKGJ1Zi5zaGlmdCgpIGFzIG51bWJlcik7XG4gICAgICB9XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICAvLyBGaW5pc2ggY3VycmVudCBSZWFkTW9kZVxuICAgIGlmIChidWZbMV0gPT09IENvZGVzLlBlcmNlbnQgJiYgYnVmWzJdID09PSBDb2Rlcy5FbmQpIHtcbiAgICAgIHN0YXRlbWVudEJ1ZldyaXRlKGJ1Zi5zaGlmdCgpIGFzIG51bWJlcik7XG4gICAgICBidWYuc3BsaWNlKDApO1xuICAgICAgLy8gRG9uJ3QgZXhlY3V0ZSBpZiBSZWFkTW9kZSBpcyBDb21tZW50LlxuICAgICAgaWYgKHJlYWRNb2RlICE9PSBSZWFkTW9kZS5Db21tZW50KSB7XG4gICAgICAgIHN3aXRjaCAocmVhZE1vZGUpIHtcbiAgICAgICAgICBjYXNlIFJlYWRNb2RlLlJhdzpcbiAgICAgICAgICAgIHN0YXRlbWVudHMucHVzaChcbiAgICAgICAgICAgICAgYDskJE9VVFBVVC5wdXNoKCR7XG4gICAgICAgICAgICAgICAgcmVtb3ZlTGFzdFNlbWkoYXdhaXQgYnVmVG9TdHIoc3RhdGVtZW50QnVmKSlcbiAgICAgICAgICAgICAgfSk7YCxcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIFJlYWRNb2RlLkVzY2FwZWQ6XG4gICAgICAgICAgICBzdGF0ZW1lbnRzLnB1c2goXG4gICAgICAgICAgICAgIGA7JCRPVVRQVVQucHVzaCgkJEVTQ0FQRSgke1xuICAgICAgICAgICAgICAgIHJlbW92ZUxhc3RTZW1pKFxuICAgICAgICAgICAgICAgICAgYXdhaXQgYnVmVG9TdHIoc3RhdGVtZW50QnVmKSxcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgIH0pKTtgLFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgUmVhZE1vZGUuRXZhbHVhdGU6XG4gICAgICAgICAgICBzdGF0ZW1lbnRzLnB1c2goYXdhaXQgYnVmVG9TdHIoc3RhdGVtZW50QnVmKSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgc3RhdGVtZW50QnVmLnJlc2V0KCk7XG4gICAgICByZWFkTW9kZSA9IFJlYWRNb2RlLk5vcm1hbDtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICBhd2FpdCBzdGF0ZW1lbnRCdWZXcml0ZShidWYuc2hpZnQoKSBhcyBudW1iZXIpO1xuICB9XG5cbiAgLy8gRmx1c2ggYnVmZmVyXG4gIHdoaWxlIChidWYubGVuZ3RoID4gMCkge1xuICAgIGF3YWl0IHN0YXRlbWVudEJ1ZldyaXRlKGJ1Zi5zaGlmdCgpIGFzIG51bWJlcik7XG4gIH1cbiAgc3RhdGVtZW50cy5wdXNoKFxuICAgIGAkJE9VVFBVVC5wdXNoKFxcYCR7YXdhaXQgYnVmVG9TdHJXaXRoU2FuaXRpemUoc3RhdGVtZW50QnVmKX1cXGApO2AsXG4gICk7XG4gIHN0YXRlbWVudEJ1Zi5yZXNldCgpO1xuXG4gIHJldHVybiBhd2FpdCBOZXdUZW1wbGF0ZShzdGF0ZW1lbnRzLmpvaW4oXCJcIikpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVuZGVyVG9TdHJpbmcoXG4gIGJvZHk6IHN0cmluZyxcbiAgcGFyYW1zOiBQYXJhbXMsXG4pOiBQcm9taXNlPHN0cmluZz4ge1xuICBjb25zdCByZWFkZXIgPSBuZXcgU3RyaW5nUmVhZGVyKGJvZHkpO1xuICBjb25zdCB0ZW1wbGF0ZSA9IGF3YWl0IGNvbXBpbGUocmVhZGVyKTtcbiAgcmV0dXJuIHRlbXBsYXRlKHBhcmFtcyk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByZW5kZXJGaWxlVG9TdHJpbmcoXG4gIHBhdGg6IHN0cmluZyxcbiAgcGFyYW1zOiBQYXJhbXMsXG4pOiBQcm9taXNlPHN0cmluZz4ge1xuICBjb25zdCBmaWxlID0gYXdhaXQgb3BlbihwYXRoKTtcbiAgY29uc3QgdGVtcGxhdGUgPSBhd2FpdCBjb21waWxlKGZpbGUpO1xuICBmaWxlLmNsb3NlKCk7XG4gIHJldHVybiB0ZW1wbGF0ZShwYXJhbXMpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVuZGVyKGJvZHk6IHN0cmluZywgcGFyYW1zOiBQYXJhbXMpOiBQcm9taXNlPFJlYWRlcj4ge1xuICBjb25zdCByZXN1bHQgPSBhd2FpdCByZW5kZXJUb1N0cmluZyhib2R5LCBwYXJhbXMpO1xuICByZXR1cm4gbmV3IFN0cmluZ1JlYWRlcihyZXN1bHQpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVuZGVyRmlsZShcbiAgcGF0aDogc3RyaW5nLFxuICBwYXJhbXM6IFBhcmFtcyxcbik6IFByb21pc2U8UmVhZGVyPiB7XG4gIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlbmRlckZpbGVUb1N0cmluZyhwYXRoLCBwYXJhbXMpO1xuICByZXR1cm4gbmV3IFN0cmluZ1JlYWRlcihyZXN1bHQpO1xufVxuIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLEtBQUssQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFDLENBQUMsR0FBRyxJQUFJO0FBRXJCLE1BQU0sR0FBRyxTQUFTLFFBQVEsQ0FBMEM7QUFDcEUsTUFBTSxHQUFHLE1BQU0sUUFBUSxDQUEyQztBQUNsRSxNQUFNLEdBQUcsT0FBTyxRQUFRLENBQXlDO0FBQ2pFLE1BQU0sQ0FBQyxNQUFNLE1BQU0sQ0FBNkM7O1VBTzNELFFBQVE7SUFBUixRQUFRLENBQVIsUUFBUSxDQUNYLENBQU0sV0FBTixDQUFNLElBQU4sQ0FBTTtJQURILFFBQVEsQ0FBUixRQUFRLENBRVgsQ0FBTyxZQUFQLENBQU8sSUFBUCxDQUFPO0lBRkosUUFBUSxDQUFSLFFBQVEsQ0FHWCxDQUFHLFFBQUgs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