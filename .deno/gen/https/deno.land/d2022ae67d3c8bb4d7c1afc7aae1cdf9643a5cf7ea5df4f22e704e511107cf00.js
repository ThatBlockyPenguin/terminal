import { Node } from "./vendor/https/deno.land/x/router/mod.ts";
import { hasTrailingSlash, NotFoundHandler } from "./util.ts";
export class Router {
    trees = {
    };
    add(method, path, h) {
        if (path[0] !== "/") {
            path = `/${path}`;
        }
        if (hasTrailingSlash(path)) {
            path = path.slice(0, path.length - 1);
        }
        let root = this.trees[method];
        if (!root) {
            root = new Node();
            this.trees[method] = root;
        }
        root.add(path, h);
    }
    find(method, c) {
        const node = this.trees[method];
        let path = c.path;
        if (hasTrailingSlash(path)) {
            path = path.slice(0, path.length - 1);
        }
        let h;
        if (node) {
            const [handle, params] = node.find(path);
            if (params) {
                for (const [k, v] of params){
                    c.params[k] = v;
                }
            }
            if (handle) {
                h = handle;
            }
        }
        return h ?? NotFoundHandler;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImh0dHBzOi8vZGVuby5sYW5kL3gvYWJjQHYxLjMuMy9yb3V0ZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBIYW5kbGVyRnVuYyB9IGZyb20gXCIuL3R5cGVzLnRzXCI7XG5pbXBvcnQgdHlwZSB7IENvbnRleHQgfSBmcm9tIFwiLi9jb250ZXh0LnRzXCI7XG5cbmltcG9ydCB7IE5vZGUgfSBmcm9tIFwiLi92ZW5kb3IvaHR0cHMvZGVuby5sYW5kL3gvcm91dGVyL21vZC50c1wiO1xuaW1wb3J0IHsgaGFzVHJhaWxpbmdTbGFzaCwgTm90Rm91bmRIYW5kbGVyIH0gZnJvbSBcIi4vdXRpbC50c1wiO1xuXG5leHBvcnQgY2xhc3MgUm91dGVyIHtcbiAgdHJlZXM6IFJlY29yZDxzdHJpbmcsIE5vZGU+ID0ge307XG5cbiAgYWRkKG1ldGhvZDogc3RyaW5nLCBwYXRoOiBzdHJpbmcsIGg6IEhhbmRsZXJGdW5jKTogdm9pZCB7XG4gICAgaWYgKHBhdGhbMF0gIT09IFwiL1wiKSB7XG4gICAgICBwYXRoID0gYC8ke3BhdGh9YDtcbiAgICB9XG5cbiAgICBpZiAoaGFzVHJhaWxpbmdTbGFzaChwYXRoKSkge1xuICAgICAgcGF0aCA9IHBhdGguc2xpY2UoMCwgcGF0aC5sZW5ndGggLSAxKTtcbiAgICB9XG5cbiAgICBsZXQgcm9vdCA9IHRoaXMudHJlZXNbbWV0aG9kXTtcbiAgICBpZiAoIXJvb3QpIHtcbiAgICAgIHJvb3QgPSBuZXcgTm9kZSgpO1xuICAgICAgdGhpcy50cmVlc1ttZXRob2RdID0gcm9vdDtcbiAgICB9XG5cbiAgICByb290LmFkZChwYXRoLCBoKTtcbiAgfVxuXG4gIGZpbmQobWV0aG9kOiBzdHJpbmcsIGM6IENvbnRleHQpOiBIYW5kbGVyRnVuYyB7XG4gICAgY29uc3Qgbm9kZSA9IHRoaXMudHJlZXNbbWV0aG9kXTtcbiAgICBsZXQgcGF0aCA9IGMucGF0aDtcbiAgICBpZiAoaGFzVHJhaWxpbmdTbGFzaChwYXRoKSkge1xuICAgICAgcGF0aCA9IHBhdGguc2xpY2UoMCwgcGF0aC5sZW5ndGggLSAxKTtcbiAgICB9XG4gICAgbGV0IGg6IEhhbmRsZXJGdW5jIHwgdW5kZWZpbmVkO1xuICAgIGlmIChub2RlKSB7XG4gICAgICBjb25zdCBbaGFuZGxlLCBwYXJhbXNdID0gbm9kZS5maW5kKHBhdGgpO1xuICAgICAgaWYgKHBhcmFtcykge1xuICAgICAgICBmb3IgKGNvbnN0IFtrLCB2XSBvZiBwYXJhbXMpIHtcbiAgICAgICAgICBjLnBhcmFtc1trXSA9IHY7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKGhhbmRsZSkge1xuICAgICAgICBoID0gaGFuZGxlIGFzIEhhbmRsZXJGdW5jO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBoID8/IE5vdEZvdW5kSGFuZGxlcjtcbiAgfVxufVxuIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUdBLE1BQU0sR0FBRyxJQUFJLFFBQVEsQ0FBMEM7QUFDL0QsTUFBTSxHQUFHLGdCQUFnQixFQUFFLGVBQWUsUUFBUSxDQUFXO0FBRTdELE1BQU0sT0FBTyxNQUFNO0lBQ2pCLEtBQUssR0FBeUIsQ0FBQztJQUFBLENBQUM7SUFFaEMsR0FBRyxDQUFDLE1BQWMsRUFBRSxJQUFZLEVBQUUsQ0FBYyxFQUFRLENBQUM7UUFDdkQsRUFBRSxFQUFFLElBQUksQ0FBQyxDQUFDLE1BQU0sQ0FBRyxJQUFFLENBQUM7WUFDcEIsSUFBSSxJQUFJLENBQUMsRUFBRSxJQUFJO1FBQ2pCLENBQUM7UUFFRCxFQUFFLEVBQUUsZ0JBQWdCLENBQUMsSUFBSSxHQUFHLENBQUM7WUFDM0IsSUFBSSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQztRQUN0QyxDQUFDO1FBRUQsR0FBRyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU07UUFDNUIsRUFBRSxHQUFHLElBQUksRUFBRSxDQUFDO1lBQ1YsSUFBSSxHQUFHLEdBQUcsQ0FBQyxJQUFJO1lBQ2YsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLElBQUksSUFBSTtRQUMzQixDQUFDO1FBRUQsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUNsQixDQUFDO0lBRUQsSUFBSSxDQUFDLE1BQWMsRUFBRSxDQUFVLEVBQWUsQ0FBQztRQUM3QyxLQUFLLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTTtRQUM5QixHQUFHLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQyxJQUFJO1FBQ2pCLEVBQUUsRUFBRSxnQkFBZ0IsQ0FBQyxJQUFJLEdBQUcsQ0FBQztZQUMzQixJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDO1FBQ3RDLENBQUM7UUFDRCxHQUFHLENBQUMsQ0FBQztRQUNMLEVBQUUsRUFBRSxJQUFJLEVBQUUsQ0FBQztZQUNULEtBQUssRUFBRSxNQUFNLEVBQUUsTUFBTSxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSTtZQUN2QyxFQUFFLEVBQUUsTUFBTSxFQUFFLENBQUM7Z0JBQ1gsR0FBRyxFQUFFLEtBQUssRUFBRSxDQUFDLEVBQUUsQ0FBQyxLQUFLLE1BQU0sQ0FBRSxDQUFDO29CQUM1QixDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDO2dCQUNqQixDQUFDO1lBQ0gsQ0FBQztZQUVELEVBQUUsRUFBRSxNQUFNLEVBQUUsQ0FBQztnQkFDWCxDQUFDLEdBQUcsTUFBTTtZQUNaLENBQUM7UUFDSCxDQUFDO1FBRUQsTUFBTSxDQUFDLENBQUMsSUFBSSxlQUFlO0lBQzdCLENBQUMifQ==